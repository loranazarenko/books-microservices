{"ast":null,"code":"import _objectSpread from\"D:/JavaProjects/ProfITsoft/books-microservices/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{useParams,useNavigate,useLocation}from'react-router-dom';import actionsBooks from'../../app/actions';import BookDetailView from'./BookDetailView';import{showNotification}from'../../app/actions/notificationActions';import{useI18n}from'../../misc/hooks/useI18n';import{jsx as _jsx}from\"react/jsx-runtime\";function BookDetail(){const dispatch=useDispatch();const navigate=useNavigate();const{id}=useParams();const location=useLocation();const{t}=useI18n();const{currentBook,authors,isLoadingDetail,isLoadingAuthors,isSaving,error}=useSelector(_ref=>{let{books}=_ref;return books;});const[isEditMode,setIsEditMode]=useState(false);const[formData,setFormData]=useState(null);const[validationErrors,setValidationErrors]=useState({});const[saveNotification,setSaveNotification]=useState(null);const isNew=id==='new';const[formError,setFormError]=useState(null);useEffect(()=>{dispatch(actionsBooks.books.fetchAuthorsList());if(!isNew){dispatch(actionsBooks.books.fetchBookDetail(id));}else{const emptyBook={id:null,title:'',yearPublished:new Date().getFullYear(),genres:[],author:null};setFormData(emptyBook);setIsEditMode(true);}return()=>{dispatch(actionsBooks.books.clearCurrentBook());};},[id,isNew,dispatch]);useEffect(()=>{if(currentBook&&!isNew){setFormData(currentBook);}},[currentBook,isNew]);const validateForm=data=>{const errors={};if(!data.title||data.title.trim()===''){errors.title='Title is required';}if(!data.author){errors.author='Author is required';}if(!data.yearPublished||data.yearPublished<1||data.yearPublished>2025){errors.yearPublished='Year must be between 1 and 2025';}return errors;};const handleEditClick=()=>{setIsEditMode(true);};const handleCancelEdit=()=>{if(isNew){navigate(-1);}else{setIsEditMode(false);setFormData(currentBook);setValidationErrors({});}};const handleFormChange=(field,value)=>{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));};const handleSave=()=>{var _formData$author;const errors=validateForm(formData);if(Object.keys(errors).length>0){setValidationErrors(errors);return;}setValidationErrors({});const payload={id:formData.id,title:formData.title,yearPublished:formData.yearPublished,genres:formData.genres||[],authorId:((_formData$author=formData.author)===null||_formData$author===void 0?void 0:_formData$author.id)||formData.author};dispatch(actionsBooks.books.saveBook(payload,isNew)).then(()=>{dispatch(showNotification({message:isNew?t('messages.created'):t('messages.updated'),severity:'success',autoHideMs:5000}));setIsEditMode(false);if(isNew){navigate('/books');}}).catch(err=>{var _err$response,_err$response$data;const errorMsg=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Failed to save';setFormError(errorMsg);});};const handleBackClick=()=>{var _location$state,_location$state2;const returnPage=((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.returnPage)||0;const returnFilters=((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.returnFilters)||{};const params=new URLSearchParams();params.set('page',returnPage);if(returnFilters.title)params.set('title',returnFilters.title);if(returnFilters.authorId)params.set('authorId',returnFilters.authorId);if(returnFilters.genre)params.set('genre',returnFilters.genre);navigate(\"/books?\".concat(params.toString()));};if(isLoadingDetail&&!isNew){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading book details...\"});}if(!formData){return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading...\"});}return/*#__PURE__*/_jsx(BookDetailView,{book:formData,authors:authors,isEditMode:isEditMode,isNew:isNew,isSaving:isSaving,isLoadingAuthors:isLoadingAuthors,validationErrors:validationErrors,saveNotification:saveNotification,error:error,onEditClick:handleEditClick,onCancelEdit:handleCancelEdit,onFormChange:handleFormChange,onSave:handleSave,onBack:handleBackClick,t:t,formError:formError});}export default BookDetail;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","useParams","useNavigate","useLocation","actionsBooks","BookDetailView","showNotification","useI18n","jsx","_jsx","BookDetail","dispatch","navigate","id","location","t","currentBook","authors","isLoadingDetail","isLoadingAuthors","isSaving","error","_ref","books","isEditMode","setIsEditMode","formData","setFormData","validationErrors","setValidationErrors","saveNotification","setSaveNotification","isNew","formError","setFormError","fetchAuthorsList","fetchBookDetail","emptyBook","title","yearPublished","Date","getFullYear","genres","author","clearCurrentBook","validateForm","data","errors","trim","handleEditClick","handleCancelEdit","handleFormChange","field","value","prev","_objectSpread","handleSave","_formData$author","Object","keys","length","payload","authorId","saveBook","then","message","severity","autoHideMs","catch","err","_err$response","_err$response$data","errorMsg","response","handleBackClick","_location$state","_location$state2","returnPage","state","returnFilters","params","URLSearchParams","set","genre","concat","toString","className","children","book","onEditClick","onCancelEdit","onFormChange","onSave","onBack"],"sources":["D:/JavaProjects/ProfITsoft/books-microservices/frontend/src/pageProviders/BookDetail/index.jsx"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\nimport {useParams, useNavigate, useLocation} from 'react-router-dom';\r\nimport actionsBooks from '../../app/actions';\r\nimport BookDetailView from './BookDetailView';\r\nimport {showNotification} from '../../app/actions/notificationActions';\r\nimport {useI18n} from '../../misc/hooks/useI18n';\r\n\r\nfunction BookDetail() {\r\n    const dispatch = useDispatch();\r\n    const navigate = useNavigate();\r\n    const {id} = useParams();\r\n    const location = useLocation();\r\n    const {t} = useI18n();\r\n\r\n    const {\r\n        currentBook,\r\n        authors,\r\n        isLoadingDetail,\r\n        isLoadingAuthors,\r\n        isSaving,\r\n        error,\r\n    } = useSelector(({books}) => books);\r\n\r\n    const [isEditMode, setIsEditMode] = useState(false);\r\n    const [formData, setFormData] = useState(null);\r\n    const [validationErrors, setValidationErrors] = useState({});\r\n    const [saveNotification, setSaveNotification] = useState(null);\r\n    const isNew = id === 'new';\r\n    const [formError, setFormError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        dispatch(actionsBooks.books.fetchAuthorsList());\r\n\r\n        if (!isNew) {\r\n            dispatch(actionsBooks.books.fetchBookDetail(id));\r\n        } else {\r\n            const emptyBook = {\r\n                id: null,\r\n                title: '',\r\n                yearPublished: new Date().getFullYear(),\r\n                genres: [],\r\n                author: null,\r\n            };\r\n            setFormData(emptyBook);\r\n            setIsEditMode(true);\r\n        }\r\n        return () => {\r\n            dispatch(actionsBooks.books.clearCurrentBook());\r\n        };\r\n\r\n    }, [id, isNew, dispatch]);\r\n\r\n    useEffect(() => {\r\n        if (currentBook && !isNew) {\r\n            setFormData(currentBook);\r\n        }\r\n    }, [currentBook, isNew]);\r\n\r\n    const validateForm = (data) => {\r\n        const errors = {};\r\n\r\n        if (!data.title || data.title.trim() === '') {\r\n            errors.title = 'Title is required';\r\n        }\r\n\r\n        if (!data.author) {\r\n            errors.author = 'Author is required';\r\n        }\r\n\r\n        if (!data.yearPublished || data.yearPublished < 1 || data.yearPublished > 2025) {\r\n            errors.yearPublished = 'Year must be between 1 and 2025';\r\n        }\r\n\r\n        return errors;\r\n    };\r\n\r\n    const handleEditClick = () => {\r\n        setIsEditMode(true);\r\n    };\r\n\r\n    const handleCancelEdit = () => {\r\n        if (isNew) {\r\n            navigate(-1);\r\n        } else {\r\n            setIsEditMode(false);\r\n            setFormData(currentBook);\r\n            setValidationErrors({});\r\n        }\r\n    };\r\n\r\n    const handleFormChange = (field, value) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            [field]: value,\r\n        }));\r\n    };\r\n\r\n    const handleSave = () => {\r\n        const errors = validateForm(formData);\r\n\r\n        if (Object.keys(errors).length > 0) {\r\n            setValidationErrors(errors);\r\n            return;\r\n        }\r\n\r\n        setValidationErrors({});\r\n\r\n        const payload = {\r\n            id: formData.id,\r\n            title: formData.title,\r\n            yearPublished: formData.yearPublished,\r\n            genres: formData.genres || [],\r\n            authorId: formData.author?.id || formData.author,\r\n        };\r\n\r\n        dispatch(actionsBooks.books.saveBook(payload, isNew))\r\n            .then(() => {\r\n                dispatch(showNotification({\r\n                    message: isNew ? t('messages.created') : t('messages.updated'),\r\n                    severity: 'success',\r\n                    autoHideMs: 5000,\r\n                }));\r\n                setIsEditMode(false);\r\n                if (isNew) {\r\n                    navigate('/books');\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                const errorMsg = err.response?.data?.message || 'Failed to save';\r\n                setFormError(errorMsg);\r\n            });\r\n    };\r\n\r\n    const handleBackClick = () => {\r\n        const returnPage = location.state?.returnPage || 0;\r\n        const returnFilters = location.state?.returnFilters || {};\r\n\r\n        const params = new URLSearchParams();\r\n        params.set('page', returnPage);\r\n        if (returnFilters.title) params.set('title', returnFilters.title);\r\n        if (returnFilters.authorId) params.set('authorId', returnFilters.authorId);\r\n        if (returnFilters.genre) params.set('genre', returnFilters.genre);\r\n\r\n        navigate(`/books?${params.toString()}`);\r\n    };\r\n\r\n    if (isLoadingDetail && !isNew) {\r\n        return <div className=\"loading\">Loading book details...</div>;\r\n    }\r\n\r\n    if (!formData) {\r\n        return <div className=\"loading\">Loading...</div>;\r\n    }\r\n\r\n    return (\r\n        <BookDetailView\r\n            book={formData}\r\n            authors={authors}\r\n            isEditMode={isEditMode}\r\n            isNew={isNew}\r\n            isSaving={isSaving}\r\n            isLoadingAuthors={isLoadingAuthors}\r\n            validationErrors={validationErrors}\r\n            saveNotification={saveNotification}\r\n            error={error}\r\n            onEditClick={handleEditClick}\r\n            onCancelEdit={handleCancelEdit}\r\n            onFormChange={handleFormChange}\r\n            onSave={handleSave}\r\n            onBack={handleBackClick}\r\n            t={t}\r\n            formError={formError}\r\n        />\r\n    );\r\n}\r\n\r\nexport default BookDetail;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}