{"ast":null,"code":"import _objectSpread from\"D:/JavaProjects/ProfITsoft/books-microservices/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useMemo}from'react';import{useLocation}from'react-router-dom';import{useSelector}from'react-redux';import*as pages from'constants/pages';import pagesURLs from'constants/pagesURLs';import useAccessValidate,{authModes}from'misc/hooks/useAccessValidate';import useChangePage from'misc/hooks/useChangePage';import useLocationSearch from'misc/hooks/useLocationSearch';import{Fragment as _Fragment,jsx as _jsx}from\"react/jsx-runtime\";function PageAccessValidator(_ref){let{neededAuthorities=[],children,mode=authModes.ANY}=_ref;const changePage=useChangePage();const location=useLocation();const locationSearch=useLocationSearch();const validateAccess=useAccessValidate();const{isFetchingSignIn,isFetchingUser,isAuthorized}=useSelector(_ref2=>{let{user}=_ref2;return user;});const[state,setState]=useState({isValid:false});const hasAccess=useMemo(()=>validateAccess(neededAuthorities,mode),[neededAuthorities,validateAccess]);useEffect(()=>{if(!isFetchingUser&&!isFetchingSignIn){if(!isAuthorized){changePage({locationSearch:_objectSpread(_objectSpread({},locationSearch),{},{redirectLocationSearch:locationSearch.redirectLocationSearch||JSON.stringify(locationSearch),redirectPathname:locationSearch.redirectPathname||location.pathname}),pathname:\"\".concat(pagesURLs[pages.login]),replace:true});}else if(!hasAccess){changePage({pathname:\"\".concat(pagesURLs[pages.defaultPage])});}else{setState(prevState=>_objectSpread(_objectSpread({},prevState),{},{isValid:true}));}}},[isFetchingUser,isAuthorized,hasAccess]);return/*#__PURE__*/_jsx(_Fragment,{children:state.isValid?children:null});}export default PageAccessValidator;","map":{"version":3,"names":["React","useEffect","useState","useMemo","useLocation","useSelector","pages","pagesURLs","useAccessValidate","authModes","useChangePage","useLocationSearch","Fragment","_Fragment","jsx","_jsx","PageAccessValidator","_ref","neededAuthorities","children","mode","ANY","changePage","location","locationSearch","validateAccess","isFetchingSignIn","isFetchingUser","isAuthorized","_ref2","user","state","setState","isValid","hasAccess","_objectSpread","redirectLocationSearch","JSON","stringify","redirectPathname","pathname","concat","login","replace","defaultPage","prevState"],"sources":["D:/JavaProjects/ProfITsoft/books-microservices/frontend/src/pageProviders/components/PageAccessValidator.jsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { useSelector } from 'react-redux';\r\nimport * as pages from 'constants/pages';\r\nimport pagesURLs from 'constants/pagesURLs';\r\nimport useAccessValidate, { authModes } from 'misc/hooks/useAccessValidate';\r\nimport useChangePage from 'misc/hooks/useChangePage';\r\nimport useLocationSearch from 'misc/hooks/useLocationSearch';\r\n\r\nfunction PageAccessValidator({\r\n  neededAuthorities = [],\r\n  children,\r\n  mode = authModes.ANY,\r\n}) {\r\n  const changePage = useChangePage();\r\n  const location = useLocation();\r\n  const locationSearch = useLocationSearch();\r\n  const validateAccess = useAccessValidate();\r\n\r\n  const {\r\n    isFetchingSignIn,\r\n    isFetchingUser,\r\n    isAuthorized,\r\n  } = useSelector(({ user }) => user);\r\n\r\n  const [state, setState] = useState({\r\n    isValid: false,\r\n  });\r\n\r\n  const hasAccess = useMemo(\r\n    () => validateAccess(neededAuthorities, mode),\r\n    [neededAuthorities, validateAccess]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!isFetchingUser && !isFetchingSignIn) {\r\n      if (!isAuthorized) {\r\n        changePage({\r\n          locationSearch: {\r\n            ...locationSearch,\r\n            redirectLocationSearch: locationSearch.redirectLocationSearch\r\n              || JSON.stringify(locationSearch),\r\n            redirectPathname: locationSearch.redirectPathname\r\n              || location.pathname,\r\n          },\r\n          pathname: `${pagesURLs[pages.login]}`,\r\n          replace: true,\r\n        });\r\n      } else if (!hasAccess) {\r\n        changePage({\r\n          pathname: `${pagesURLs[pages.defaultPage]}`,\r\n        });\r\n      } else {\r\n        setState(prevState => ({\r\n          ...prevState,\r\n          isValid: true,\r\n        }));\r\n      }\r\n    }\r\n  }, [isFetchingUser, isAuthorized, hasAccess]);\r\n\r\n  return (\r\n    <>\r\n      {state.isValid ? children : null}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default PageAccessValidator;\r\n"],"mappings":"4IAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,CAAEC,OAAO,KAAQ,OAAO,CAC3D,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,WAAW,KAAQ,aAAa,CACzC,MAAO,GAAK,CAAAC,KAAK,KAAM,iBAAiB,CACxC,MAAO,CAAAC,SAAS,KAAM,qBAAqB,CAC3C,MAAO,CAAAC,iBAAiB,EAAIC,SAAS,KAAQ,8BAA8B,CAC3E,MAAO,CAAAC,aAAa,KAAM,0BAA0B,CACpD,MAAO,CAAAC,iBAAiB,KAAM,8BAA8B,CAAC,OAAAC,QAAA,IAAAC,SAAA,CAAAC,GAAA,IAAAC,IAAA,yBAE7D,QAAS,CAAAC,mBAAmBA,CAAAC,IAAA,CAIzB,IAJ0B,CAC3BC,iBAAiB,CAAG,EAAE,CACtBC,QAAQ,CACRC,IAAI,CAAGX,SAAS,CAACY,GACnB,CAAC,CAAAJ,IAAA,CACC,KAAM,CAAAK,UAAU,CAAGZ,aAAa,CAAC,CAAC,CAClC,KAAM,CAAAa,QAAQ,CAAGnB,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAAoB,cAAc,CAAGb,iBAAiB,CAAC,CAAC,CAC1C,KAAM,CAAAc,cAAc,CAAGjB,iBAAiB,CAAC,CAAC,CAE1C,KAAM,CACJkB,gBAAgB,CAChBC,cAAc,CACdC,YACF,CAAC,CAAGvB,WAAW,CAACwB,KAAA,MAAC,CAAEC,IAAK,CAAC,CAAAD,KAAA,OAAK,CAAAC,IAAI,GAAC,CAEnC,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAG9B,QAAQ,CAAC,CACjC+B,OAAO,CAAE,KACX,CAAC,CAAC,CAEF,KAAM,CAAAC,SAAS,CAAG/B,OAAO,CACvB,IAAMsB,cAAc,CAACP,iBAAiB,CAAEE,IAAI,CAAC,CAC7C,CAACF,iBAAiB,CAAEO,cAAc,CACpC,CAAC,CAEDxB,SAAS,CAAC,IAAM,CACd,GAAI,CAAC0B,cAAc,EAAI,CAACD,gBAAgB,CAAE,CACxC,GAAI,CAACE,YAAY,CAAE,CACjBN,UAAU,CAAC,CACTE,cAAc,CAAAW,aAAA,CAAAA,aAAA,IACTX,cAAc,MACjBY,sBAAsB,CAAEZ,cAAc,CAACY,sBAAsB,EACxDC,IAAI,CAACC,SAAS,CAACd,cAAc,CAAC,CACnCe,gBAAgB,CAAEf,cAAc,CAACe,gBAAgB,EAC5ChB,QAAQ,CAACiB,QAAQ,EACvB,CACDA,QAAQ,IAAAC,MAAA,CAAKlC,SAAS,CAACD,KAAK,CAACoC,KAAK,CAAC,CAAE,CACrCC,OAAO,CAAE,IACX,CAAC,CAAC,CACJ,CAAC,IAAM,IAAI,CAACT,SAAS,CAAE,CACrBZ,UAAU,CAAC,CACTkB,QAAQ,IAAAC,MAAA,CAAKlC,SAAS,CAACD,KAAK,CAACsC,WAAW,CAAC,CAC3C,CAAC,CAAC,CACJ,CAAC,IAAM,CACLZ,QAAQ,CAACa,SAAS,EAAAV,aAAA,CAAAA,aAAA,IACbU,SAAS,MACZZ,OAAO,CAAE,IAAI,EACb,CAAC,CACL,CACF,CACF,CAAC,CAAE,CAACN,cAAc,CAAEC,YAAY,CAAEM,SAAS,CAAC,CAAC,CAE7C,mBACEnB,IAAA,CAAAF,SAAA,EAAAM,QAAA,CACGY,KAAK,CAACE,OAAO,CAAGd,QAAQ,CAAG,IAAI,CAChC,CAAC,CAEP,CAEA,cAAe,CAAAH,mBAAmB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}