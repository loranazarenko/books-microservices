{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{useNavigate,useSearchParams}from'react-router-dom';import actionsBooks from'../../app/actions';import BooksListView from'./BooksListView';import{showNotification}from'../../app/actions/notificationActions';import{useI18n}from'../../misc/hooks/useI18n';import{jsx as _jsx}from\"react/jsx-runtime\";function BooksList(){const dispatch=useDispatch();const navigate=useNavigate();const[searchParams,setSearchParams]=useSearchParams();const{items,page,pageSize,totalPages,filters,isLoadingList,isDeleting,error,deleteError,authors}=useSelector(_ref=>{let{books}=_ref;return books;});const[deleteDialogOpen,setDeleteDialogOpen]=useState(false);const[bookToDelete,setBookToDelete]=useState(null);const[deleteErrorMessage,setDeleteErrorMessage]=useState(null);const{t,lang,changeLang}=useI18n();useEffect(()=>{const pageFromUrl=parseInt(searchParams.get('page'))||0;const titleFromUrl=searchParams.get('title')||'';const authorIdFromUrl=searchParams.get('authorId');const genreFromUrl=searchParams.get('genre')||'';const filtersToApply={title:titleFromUrl,authorId:authorIdFromUrl?parseInt(authorIdFromUrl):null,genre:genreFromUrl};dispatch(actionsBooks.books.fetchAuthorsList());dispatch(actionsBooks.books.fetchBooksList(pageFromUrl,filtersToApply));},[dispatch,searchParams]);const handleFilterChange=newFilters=>{const params=new URLSearchParams();params.set('page','0');if(newFilters.title)params.set('title',newFilters.title);if(newFilters.authorId)params.set('authorId',newFilters.authorId);if(newFilters.genre)params.set('genre',newFilters.genre);setSearchParams(params);dispatch(actionsBooks.books.setFilters(newFilters));dispatch(actionsBooks.books.fetchBooksList(0,newFilters));};const handlePageChange=newPage=>{const params=new URLSearchParams(searchParams);params.set('page',newPage);setSearchParams(params);dispatch(actionsBooks.books.setPage(newPage));dispatch(actionsBooks.books.fetchBooksList(newPage,filters));};const handleDeleteClick=book=>{setBookToDelete(book);setDeleteDialogOpen(true);setDeleteErrorMessage(null);};const handleConfirmDelete=async()=>{if(bookToDelete){try{await dispatch(actionsBooks.books.deleteBook(bookToDelete.id));setDeleteDialogOpen(false);setBookToDelete(null);setDeleteErrorMessage(null);dispatch(showNotification({message:\"Book \\\"\".concat(bookToDelete.title,\"\\\" successfully deleted\"),severity:'success'}));}catch(error){var _error$response,_error$response$data;const errorMsg=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||error.message||'Failed to delete book. Please try again.';setDeleteErrorMessage(errorMsg);}}};const handleBookClick=bookId=>{navigate(\"/books/\".concat(bookId),{state:{returnPage:page,returnFilters:filters}});};const handleAddBook=()=>{navigate('/books/new',{state:{returnPage:page,returnFilters:filters}});};const handleResetFilters=()=>{dispatch(actionsBooks.books.resetFilters());setSearchParams(new URLSearchParams());dispatch(actionsBooks.books.fetchBooksList(0,{title:'',authorId:null,genre:''}));};return/*#__PURE__*/_jsx(BooksListView,{books:items,authors:authors,page:page,pageSize:pageSize,totalPages:totalPages,filters:filters,isLoading:isLoadingList,isDeleting:isDeleting,error:error,deleteError:deleteError,deleteErrorMessage:deleteErrorMessage,deleteDialogOpen:deleteDialogOpen,bookToDelete:bookToDelete,onFilterChange:handleFilterChange,onPageChange:handlePageChange,onDeleteClick:handleDeleteClick,onConfirmDelete:handleConfirmDelete,onCancelDelete:()=>{setDeleteDialogOpen(false);setDeleteErrorMessage(null);},onBookClick:handleBookClick,onAddBook:handleAddBook,onResetFilters:handleResetFilters,lang:lang,changeLang:changeLang,t:t});}export default BooksList;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","useNavigate","useSearchParams","actionsBooks","BooksListView","showNotification","useI18n","jsx","_jsx","BooksList","dispatch","navigate","searchParams","setSearchParams","items","page","pageSize","totalPages","filters","isLoadingList","isDeleting","error","deleteError","authors","_ref","books","deleteDialogOpen","setDeleteDialogOpen","bookToDelete","setBookToDelete","deleteErrorMessage","setDeleteErrorMessage","t","lang","changeLang","pageFromUrl","parseInt","get","titleFromUrl","authorIdFromUrl","genreFromUrl","filtersToApply","title","authorId","genre","fetchAuthorsList","fetchBooksList","handleFilterChange","newFilters","params","URLSearchParams","set","setFilters","handlePageChange","newPage","setPage","handleDeleteClick","book","handleConfirmDelete","deleteBook","id","message","concat","severity","_error$response","_error$response$data","errorMsg","response","data","handleBookClick","bookId","state","returnPage","returnFilters","handleAddBook","handleResetFilters","resetFilters","isLoading","onFilterChange","onPageChange","onDeleteClick","onConfirmDelete","onCancelDelete","onBookClick","onAddBook","onResetFilters"],"sources":["D:/JavaProjects/ProfITsoft/books-microservices/frontend/src/pageProviders/BooksList/index.jsx"],"sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {useDispatch, useSelector} from 'react-redux';\r\nimport {useNavigate, useSearchParams} from 'react-router-dom';\r\nimport actionsBooks from '../../app/actions';\r\nimport BooksListView from './BooksListView';\r\nimport {showNotification} from '../../app/actions/notificationActions';\r\nimport {useI18n} from '../../misc/hooks/useI18n';\r\n\r\n\r\nfunction BooksList() {\r\n    const dispatch = useDispatch();\r\n    const navigate = useNavigate();\r\n    const [searchParams, setSearchParams] = useSearchParams();\r\n\r\n    const {\r\n        items,\r\n        page,\r\n        pageSize,\r\n        totalPages,\r\n        filters,\r\n        isLoadingList,\r\n        isDeleting,\r\n        error,\r\n        deleteError,\r\n        authors,\r\n    } = useSelector(({books}) => books);\r\n\r\n    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n    const [bookToDelete, setBookToDelete] = useState(null);\r\n    const [deleteErrorMessage, setDeleteErrorMessage] = useState(null);\r\n    const {t, lang, changeLang} = useI18n();\r\n\r\n    useEffect(() => {\r\n        const pageFromUrl = parseInt(searchParams.get('page')) || 0;\r\n        const titleFromUrl = searchParams.get('title') || '';\r\n        const authorIdFromUrl = searchParams.get('authorId');\r\n        const genreFromUrl = searchParams.get('genre') || '';\r\n\r\n        const filtersToApply = {\r\n            title: titleFromUrl,\r\n            authorId: authorIdFromUrl ? parseInt(authorIdFromUrl) : null,\r\n            genre: genreFromUrl,\r\n        };\r\n\r\n        dispatch(actionsBooks.books.fetchAuthorsList());\r\n\r\n        dispatch(actionsBooks.books.fetchBooksList(pageFromUrl, filtersToApply));\r\n    }, [dispatch, searchParams]);\r\n\r\n    const handleFilterChange = (newFilters) => {\r\n        const params = new URLSearchParams();\r\n        params.set('page', '0');\r\n        if (newFilters.title) params.set('title', newFilters.title);\r\n        if (newFilters.authorId) params.set('authorId', newFilters.authorId);\r\n        if (newFilters.genre) params.set('genre', newFilters.genre);\r\n        setSearchParams(params);\r\n\r\n        dispatch(actionsBooks.books.setFilters(newFilters));\r\n        dispatch(actionsBooks.books.fetchBooksList(0, newFilters));\r\n    };\r\n\r\n    const handlePageChange = (newPage) => {\r\n        const params = new URLSearchParams(searchParams);\r\n        params.set('page', newPage);\r\n        setSearchParams(params);\r\n\r\n        dispatch(actionsBooks.books.setPage(newPage));\r\n        dispatch(actionsBooks.books.fetchBooksList(newPage, filters));\r\n    };\r\n\r\n    const handleDeleteClick = (book) => {\r\n        setBookToDelete(book);\r\n        setDeleteDialogOpen(true);\r\n        setDeleteErrorMessage(null);\r\n    };\r\n\r\n    const handleConfirmDelete = async () => {\r\n        if (bookToDelete) {\r\n            try {\r\n                await dispatch(actionsBooks.books.deleteBook(bookToDelete.id));\r\n                setDeleteDialogOpen(false);\r\n                setBookToDelete(null);\r\n                setDeleteErrorMessage(null);\r\n\r\n                dispatch(showNotification({\r\n                    message: `Book \"${bookToDelete.title}\" successfully deleted`,\r\n                    severity: 'success'\r\n                }));\r\n            } catch (error) {\r\n                const errorMsg = error.response?.data?.message\r\n                    || error.message\r\n                    || 'Failed to delete book. Please try again.';\r\n\r\n                setDeleteErrorMessage(errorMsg);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleBookClick = (bookId) => {\r\n        navigate(`/books/${bookId}`, {\r\n            state: {returnPage: page, returnFilters: filters}\r\n        });\r\n    };\r\n\r\n    const handleAddBook = () => {\r\n        navigate('/books/new', {\r\n            state: {returnPage: page, returnFilters: filters}\r\n        });\r\n    };\r\n\r\n    const handleResetFilters = () => {\r\n        dispatch(actionsBooks.books.resetFilters());\r\n        setSearchParams(new URLSearchParams());\r\n\r\n        dispatch(actionsBooks.books.fetchBooksList(0, {\r\n            title: '',\r\n            authorId: null,\r\n            genre: '',\r\n        }));\r\n    };\r\n\r\n    return (\r\n        <BooksListView\r\n            books={items}\r\n            authors={authors}\r\n            page={page}\r\n            pageSize={pageSize}\r\n            totalPages={totalPages}\r\n            filters={filters}\r\n            isLoading={isLoadingList}\r\n            isDeleting={isDeleting}\r\n            error={error}\r\n            deleteError={deleteError}\r\n            deleteErrorMessage={deleteErrorMessage}\r\n            deleteDialogOpen={deleteDialogOpen}\r\n            bookToDelete={bookToDelete}\r\n            onFilterChange={handleFilterChange}\r\n            onPageChange={handlePageChange}\r\n            onDeleteClick={handleDeleteClick}\r\n            onConfirmDelete={handleConfirmDelete}\r\n            onCancelDelete={() => {\r\n                setDeleteDialogOpen(false);\r\n                setDeleteErrorMessage(null);\r\n            }}\r\n            onBookClick={handleBookClick}\r\n            onAddBook={handleAddBook}\r\n            onResetFilters={handleResetFilters}\r\n            lang={lang}\r\n            changeLang={changeLang}\r\n            t={t}\r\n        />\r\n    );\r\n}\r\n\r\nexport default BooksList;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}